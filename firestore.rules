
rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    match /users/{userId} {
      // Users can only read and write their own profile data.
      allow read, write: if request.auth.uid == userId;

      // Users can only read and write their own badges.
      // This rule is nested inside the user document match.
      match /userBadges/{badgeId} {
        allow read, write: if request.auth.uid == userId;
      }
    }

    // Users can only read and write their own quiz progress.
    match /quizProgress/{progressId} {
      // The progressId is formatted as `${userId}_${topicId}`
      allow read, write: if request.auth.uid == split(progressId, '_')[0];
    }
  }
}
