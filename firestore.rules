rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    /* ─────────────── Helper functions ─────────────── */
    function isSignedIn() {
      return request.auth != null;
    }

    function isSelf(userId) {
      return isSignedIn() && request.auth.uid == userId;
    }

    /* ───────────────── Users collection ────────────── */
    match /users/{userId} {

      // Read access (for the leaderboard) — any signed‑in user.
      allow get, list: if isSignedIn();

      // Write access — only the owner of the profile.
      allow create, update, delete: if isSelf(userId);
    }

    /* ───────────── Quiz progress collection ────────── */
    // Each document ID is expected to be `${uid}_${quizId}`
    match /quizProgress/{progressId} {

      // A user may read/write only their own progress docs.
      allow get, list, create, update, delete: if isSignedIn() &&
        progressId.matches('^' + request.auth.uid + '_.+');
    }
  }
}

